<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>かけ算 九九パズル</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap" rel="stylesheet">
    <style>
        /* * 全体のスタイル設定
         * これまでのプリントと同じ、手書き風で丸みのあるフォント「Yusei Magic」を使用しています。
         */
        body {
            font-family: 'Yusei Magic', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 0;
            padding: 20px;
            background-color: #fafffd;
            color: #333;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* * アプリ全体のコンテナ
         */
        .container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            box-sizing: border-box;
            background-color: white;
            border: 2px dashed #8cf;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* * タイトルのスタイル
         */
        h1 {
            font-size: 28px;
            color: #58a;
            margin-top: 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: center;
        }
        
        .icon {
            width: 30px;
            height: 30px;
            fill: #8cf;
            flex-shrink: 0;
        }

        /* * 表のスタイル
         */
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #ccc;
            text-align: center;
            font-size: clamp(14px, 3vw, 18px); /* 画面サイズに応じてフォントサイズを調整 */
            width: 9%;
            height: 45px;
        }

        /* * ヘッダーのスタイル
         */
        th {
            background-color: #e4f4ff;
            color: #55a;
        }
        
        /* * 数字を入力するマスのスタイル
         */
        td input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            font-size: inherit; /* 親要素のフォントサイズを継承 */
            font-family: 'Yusei Magic', sans-serif;
            background-color: #fff9e0;
            padding: 0;
            box-sizing: border-box;
        }
        /* スピナー（上下矢印）を非表示に */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* * 正解・不正解のスタイル
         */
        .correct {
            background-color: #d4edda !important;
            color: #155724;
        }
        .incorrect {
            background-color: #f8d7da !important;
            color: #721c24;
        }

        /* * ボタンとメッセージのエリア
         */
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        /* * ボタンのスタイル
         */
        button {
            font-family: 'Yusei Magic', sans-serif;
            font-size: 16px;
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            background-color: #58a;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }

        /* * メッセージのスタイル
         */
        #message {
            font-size: 18px;
            font-weight: bold;
            height: 30px;
            display: flex;
            align-items: center;
        }
        .message-correct { color: #155724; }
        .message-incorrect { color: #721c24; }

    </style>
</head>
<body>
    <div class="container">
        <h1>
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
            かけ算 九九パズル
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
        </h1>
        <table id="kuku-table"></table>
        <div class="controls">
            <button id="check-button">こたえあわせ</button>
            <button id="new-game-button">あたらしい もんだい</button>
            <p id="message"></p>
        </div>
    </div>

    <script>
        const tableElement = document.getElementById('kuku-table');
        const checkButton = document.getElementById('check-button');
        const newGameButton = document.getElementById('new-game-button');
        const messageElement = document.getElementById('message');
        
        const tableSize = 10; // 10x10の表を作成
        const blankCount = 15; // 空白にするマスの数
        let blankCells = []; // 空白のマスの情報を保存する配列

        // 新しい問題を作成する関数
        function generatePuzzle() {
            // 準備
            tableElement.innerHTML = '';
            messageElement.textContent = '';
            blankCells = [];

            // 1. どのマスを空白にするかランダムに選ぶ
            const allCells = [];
            for (let r = 1; r <= tableSize; r++) {
                for (let c = 1; c <= tableSize; c++) {
                    allCells.push({ row: r, col: c });
                }
            }
            // 配列をシャッフルして、先頭から指定個数取り出す
            allCells.sort(() => Math.random() - 0.5);
            const cellsToBlank = allCells.slice(0, blankCount);

            // 2. 表をHTMLで作成する
            // ヘッダー行 (×, 1, 2, ..., 10)
            let headerRow = '<tr><th>×</th>';
            for (let i = 1; i <= tableSize; i++) {
                headerRow += `<th>${i}</th>`;
            }
            headerRow += '</tr>';
            tableElement.innerHTML += headerRow;

            // データ行 (1から10の段)
            for (let r = 1; r <= tableSize; r++) {
                let rowHtml = `<tr><th>${r}</th>`;
                for (let c = 1; c <= tableSize; c++) {
                    const answer = r * c;
                    // このマスが空白にするマスかどうかチェック
                    const isBlank = cellsToBlank.some(cell => cell.row === r && cell.col === c);
                    
                    if (isBlank) {
                        // 空白にするマスの場合、input要素を作成
                        rowHtml += `<td><input type="number" data-answer="${answer}" data-row="${r}" data-col="${c}"></td>`;
                        blankCells.push({ row: r, col: c, answer: answer });
                    } else {
                        // 数字のマス
                        rowHtml += `<td>${answer}</td>`;
                    }
                }
                rowHtml += '</tr>';
                tableElement.innerHTML += rowHtml;
            }
        }

        // 答え合わせをする関数
        function checkAnswers() {
            let correctCount = 0;
            const allInputs = document.querySelectorAll('#kuku-table input');

            allInputs.forEach(input => {
                // スタイルをリセット
                input.classList.remove('correct', 'incorrect');

                const userAnswer = parseInt(input.value, 10);
                const correctAnswer = parseInt(input.dataset.answer, 10);

                if (userAnswer === correctAnswer) {
                    input.classList.add('correct');
                    correctCount++;
                } else {
                    input.classList.add('incorrect');
                }
            });

            // メッセージを表示
            if (correctCount === blankCount) {
                messageElement.textContent = 'パーフェクト！すごい！';
                messageElement.className = 'message-correct';
            } else {
                messageElement.textContent = `おしい！あと ${blankCount - correctCount} こ`;
                messageElement.className = 'message-incorrect';
            }
        }

        // ボタンにイベントを登録
        checkButton.addEventListener('click', checkAnswers);
        newGameButton.addEventListener('click', generatePuzzle);

        // ページが読み込まれたら、最初の問題を作成
        generatePuzzle();
    </script>
</body>
</html>
